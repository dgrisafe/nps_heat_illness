---
title: "GrCa HRI Exploratory Data Analysis"
author: "Dom Grisafe"
date: "`r Sys.Date()`"
output: 
  html_document:
    keep_md: FALSE
    toc: true
    toc_float: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tableone) # summary table
library(kableExtra) # html tables
library(mapview) # mapping
```

# Load Analytic Dataset

```{r}
df_screen <- readRDS(paste0(dir_data, "\\df_screen.rds"))
```
# Map 1: Case Origins

## Country

## State


# Table 1: Cohort Description

Simple tables for variables in the analytic dataset

## Overall

```{r}
tableone::CreateTableOne(
  data = df_screen, 
  includeNA = FALSE,
  vars = c(
    "age_disp", "gender", "race_ethnicity", "continent", "state", # var_demographic
    "height", "weight", # var_medical
    "dispatch_mos", "dispatch_year" # var_ems
    )
  ) %>% 
  kableone() %>% 
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  pack_rows("Demographics", 2, 11) %>% 
  pack_rows("Continent of Origin", 12, 17) %>% 
  pack_rows("State/Providence", 18, 82) %>% 
  pack_rows("Clinical Information", 83, 84) %>% 
  pack_rows("Dispatch Day", 85, 86)
```

## Overall, Missing

```{r}
tableone::CreateTableOne(
  data = df_screen, 
  includeNA = TRUE,
  vars = c(
    "age_disp", "gender", "race_ethnicity", "continent", "state", # var_demographic
    "height", "weight", # var_medical
    "dispatch_mos", "dispatch_year" # var_ems
    )
  ) %>% 
  kableone() %>% 
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  pack_rows("Demographics", 2, 13) %>% 
  pack_rows("Continent of Origin", 14, 20) %>% 
  pack_rows("State/Providence", 21, 86) %>% 
  pack_rows("Clinical Information", 87, 88) %>% 
  pack_rows("Dispatch Day", 89, 90)
```

## By Case Status

```{r}
tableone::CreateTableOne(
  data = df_screen, 
  strata = "case_screen", includeNA = TRUE,
  vars = c(
    "age_disp", "gender", "race_ethnicity", "continent", "state", # var_demographic
    "height", "weight", # var_medical
    "dispatch_mos", "dispatch_year" # var_ems
    )
  ) %>% 
  kableone() %>% 
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  pack_rows("Demographics", 2, 13) %>% 
  pack_rows("Continent of Origin", 14, 20) %>% 
  pack_rows("State/Providence", 21, 86) %>% 
  pack_rows("Clinical Information", 87, 88) %>% 
  pack_rows("Dispatch Day", 89, 90)
```

# Map 2: Grand Canyon Case Location

```{r}
# create data with coordinates of bases for mapping
base_coord <- tibble(
  base_region = df_screen$base_region %>% levels,
  base_lat  = c(36.056198, 36.1058432, 36.0884229, 36.0029983),
  base_long = c(-112.125198, -112.0968523, -112.1382771, -114.0663743)
)

# add base location data to data
df_grca_map <- merge(base_coord, df_screen, by = "base_region")
```

```{r}
df_map <- df_grca_map %>% 
  filter(!is.na(scene_lat) & !is.na(scene_long) & !is.na(base_region)) %>% 
  select(scene_lat, scene_long, base_region)

mapviewOptions(basemaps = "OpenTopoMap")
map_base <- mapview(df_map, xcol = "scene_long", ycol = "scene_lat", zcol = "base_region")
  
  # na.color = "gray",
  # label = "base_region",
  # # cex = "number.of.types"
  # zcol = "base_region",
  # map.types = mapviewGetOption("basemaps")

map_base
```


`r nrow(df_grca_map)` (`r round(100 * nrow(df_grca_map) / nrow(df_screen), digits = 2)`%) cases have latitude and longitude data available


# Table 2: Medicial Conditions, Medications

# Table 3: Activity Engaged

# Table 4: Paramedic Assessments

# Figure 1: Temperature and Rate per 100,000 on Month

Where do we get the temperature data?

Should we try a three dimensional plot where the z-axis is the year? This would consolidate many graphs, but may be too confusing to interpret.
