---
title: "GrCa HRI Exploratory Data Analysis"
author: "Dom Grisafe"
date: "`r Sys.Date()`"
output: 
  html_document:
    keep_md: FALSE
    toc: true
    toc_float: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tableone) # summary table
library(kableExtra) # html tables
library(mapview) # mapping
```

# Load Analytic Dataset

```{r}
df_screen <- readRDS(paste0(dir_data, "\\df_screen.rds"))
```
# Map 1: Case Origins

## Country

## State


# Table 1: Cohort Description

Simple tables for variables in the analytic dataset

## Overall

```{r}
tableone::CreateTableOne(
  data = df_screen, 
  includeNA = FALSE,
  vars = c(
    "age_disp", "gender", "race_ethnicity", "country", "state", # var_demographic
    "height", "weight", # var_medical
    "dispatch_mos", "dispatch_year" # var_ems
    )
  ) %>% 
  kableone() %>% 
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  pack_rows("Demographics", 2, 8) %>% 
  pack_rows("Nation of Origin", 9, 12) %>% 
  pack_rows("State of USA", 13, 47) %>% 
  pack_rows("Clinical Information", 48, 49) %>% 
  pack_rows("Dispatch Day", 50, 51)
```

## Overall, Missing

```{r}
tableone::CreateTableOne(
  data = df_screen, 
  includeNA = TRUE,
  vars = c(
    "age_disp", "gender", "race_ethnicity", "country", "state", # var_demographic
    "height", "weight", # var_medical
    "dispatch_mos", "dispatch_year" # var_ems
    )
  ) %>% 
  kableone() %>% 
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  pack_rows("Demographics", 2, 12) %>% 
  pack_rows("Nation of Origin", 13, 17) %>% 
  pack_rows("State of USA", 18, 53) %>% 
  pack_rows("Clinical Information", 54, 55) %>%
  pack_rows("Dispatch Day", 56, 57)
```

## By Case Status

```{r}
tableone::CreateTableOne(
  data = df_screen, 
  strata = "case_screen", includeNA = TRUE,
  vars = c(
    "age_disp", "gender", "race_ethnicity", "country", "state", # var_demographic
    "height", "weight", # var_medical
    "dispatch_mos", "dispatch_year" # var_ems
    )
  ) %>% 
  kableone() %>% 
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  pack_rows("Demographics", 2, 12) %>% 
  pack_rows("Nation of Origin", 13, 17) %>% 
  pack_rows("State of USA", 18, 53) %>% 
  pack_rows("Clinical Information", 54, 55) %>%
  pack_rows("Dispatch Day", 56, 57)
```

# Map 2: Grand Canyon Case Location

```{r}
df_grca_map <- df_screen %>% filter(!is.na(scene_lat) & !is.na(scene_long))
map_grca_2_scene <- mapview(df_grca_map, xcol = "scene_long", ycol = "scene_lat", crs = 4269, grid = FALSE)
# mapshot(map_grca_2_scene, file = paste0(dir_reports,"map_grca_2_scene.png"), remove_controls = NULL)
```

`r nrow(df_grca_map)` (`r round(100 * nrow(df_grca_map) / nrow(df_screen), digits = 2)`%) cases have latitude and longitude data available

```{r}
map_grca_2_scene
```


# Table 2: Medicial Conditions, Medications

# Table 3: Activity Engaged

# Table 4: Paramedic Assessments

# Figure 1: Temperature and Rate per 100,000 on Month

Where do we get the temperature data?

Should we try a three dimensional plot where the z-axis is the year? This would consolidate many graphs, but may be too confusing to interpret.
